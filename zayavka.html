<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Заявка на оцінку відповідності</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    label { display: block; margin-top: 10px; }
    input, textarea { padding: 5px; width: 100%; }
    table { border-collapse: collapse; margin-top: 15px; width: 100%; }
    th, td { border: 1px solid #000; padding: 5px; text-align: left; }
    .btn { margin-top: 10px; padding: 8px 12px; background: #2a7ae2; color: #fff; border: none; cursor: pointer; }
    .result { margin-top: 30px; padding: 20px; border: 1px solid #ccc; background: #f9f9f9; }
  </style>
</head>
<body>

<h2>Форма для заповнення заявки</h2>

<label>Назва підприємства-заявника: <input type="text" id="company"></label>
<label>Код ЄДРПОУ: <input type="text" id="edrpou"></label>
<label>Адреса виробництва: <input type="text" id="address"></label>
<label>Адреса потужностей виробництва: <input type="text" id="prodAddress"></label>
<label>Керівник (ПІБ та посада): <input type="text" id="director"></label>

<h3>Партії продукції</h3>
<table id="batches">
  <tr><th>Назва продукції</th><th>Номер партії</th><th>Дата виготовлення</th><th>Кількість</th><th>Дія</th></tr>
</table>
<button type="button" class="btn" onclick="addBatch()">+ Додати партію</button>

<h3>Перелік ПАР</h3>
<table id="pars">
  <tr><th>№</th><th>Хімічне найменування</th><th>Торгова марка</th><th>CAS №</th><th>Протокол</th><th>Дія</th></tr>
</table>
<button type="button" class="btn" onclick="addPar()">+ Додати ПАР</button>

<br><br>
<button type="button" class="btn" onclick="generate()">Згенерувати заявку</button>

<div id="output" class="result"></div>

<script>
function addBatch() {
  const table = document.getElementById('batches');
  const row = table.insertRow();
  row.innerHTML = `
    <td><input type="text"></td>
    <td><input type="text"></td>
    <td><input type="date"></td>
    <td><input type="number"></td>
    <td><button onclick="this.parentNode.parentNode.remove()">Видалити</button></td>
  `;
}

function addPar() {
  const table = document.getElementById('pars');
  const row = table.insertRow();
  const index = table.rows.length - 1;
  row.innerHTML = `
    <td>${index}</td>
    <td><input type="text"></td>
    <td><input type="text"></td>
    <td><input type="text"></td>
    <td><input type="text"></td>
    <td><button onclick="this.parentNode.parentNode.remove()">Видалити</button></td>
  `;
}

function generate() {
  // Основні дані
  const company = document.getElementById('company').value;
  const edrpou = document.getElementById('edrpou').value;
  const address = document.getElementById('address').value;
  const prodAddress = document.getElementById('prodAddress').value;
  const director = document.getElementById('director').value;

  // Партії
  let batches = "";
  document.querySelectorAll("#batches tr").forEach((row,i)=>{
    if(i===0) return;
    const inputs=row.querySelectorAll("input");
    batches += `<tr><td>${i}</td><td>${inputs[0].value}</td><td>${inputs[1].value} від ${inputs[2].value}</td><td>${inputs[3].value}</td></tr>`;
  });

  // ПАР
  let pars = "";
  document.querySelectorAll("#pars tr").forEach((row,i)=>{
    if(i===0) return;
    const inputs=row.querySelectorAll("input");
    pars += `<tr><td>${i}</td><td>${inputs[0].value}</td><td>${inputs[1].value}</td><td>${inputs[2].value}</td><td>${inputs[3].value}</td></tr>`;
  });

  // Завантаження шаблону Word (лежить поруч у папці)
  fetch("Бланк1.docx")
    .then(response => response.blob())
    .then(blob => {
      // Тут можна використати бібліотеку docxtemplater або PizZip для підстановки змінних
      // Для простоти покажемо підстановку у HTML
      let content = `
        <h3 style="text-align:center;">З А Я В К А</h3>
        <p>${company}, ${address}, Код ЄДРПОУ: ${edrpou}</p>
        <p>Адреса потужностей виробництва: ${prodAddress}</p>
        <p>Керівник: ${director}</p>
        <h4>Додаток</h4>
        <table border="1"><tr><th>№</th><th>Назва</th><th>Номер партії</th><th>Кількість</th></tr>${batches}</table>
        <h4>Перелік ПАР</h4>
        <table border="1"><tr><th>№</th><th>Хімічне найменування</th><th>Торгова марка</th><th>CAS №</th><th>Протокол</th></tr>${pars}</table>
      `;
      document.getElementById('output').innerHTML = content;

      // Збереження у Word
      const header = "<html><head><meta charset='utf-8'></head><body>";
      const footer = "</body></html>";
      const sourceHTML = header + content + footer;
      const outBlob = new Blob(['\ufeff', sourceHTML], { type: 'application/msword' });
      const url = URL.createObjectURL(outBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'zayavka.doc';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    });
}
</script>

</body>
</html>
